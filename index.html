<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>요약하기: 인간과 AI의 협업 - GitHub 연동 워크북</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.8;
            color: #2c3e50;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.95;
        }
        
        .student-info {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .student-info input {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            font-size: 1em;
            background: rgba(255,255,255,0.9);
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 50px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
            position: relative;
        }
        
        .section-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .status-incomplete {
            background: #ffebee;
            color: #c62828;
        }
        
        .status-complete {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h3 {
            color: #495057;
            margin: 20px 0 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 5px;
        }
        
        .text-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .ai-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .human-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .activity {
            background: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px dashed #764ba2;
        }
        
        .activity-title {
            color: #764ba2;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .char-count {
            text-align: right;
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 5px;
        }
        
        .control-panel {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 10px;
            z-index: 1000;
            flex-direction: column;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-save {
            background: #4caf50;
            color: white;
        }
        
        .btn-save:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .btn-github {
            background: #24292e;
            color: white;
        }
        
        .btn-github:hover {
            background: #1a1e22;
            transform: translateY(-2px);
        }
        
        .btn-export {
            background: #ff9800;
            color: white;
        }
        
        .btn-export:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .progress-bar {
            position: sticky;
            top: 0;
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            margin: -40px -40px 40px -40px;
        }
        
        .progress-container {
            background: #e9ecef;
            border-radius: 10px;
            height: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 10px;
            font-weight: 600;
            color: #495057;
        }
        
        .toast {
            position: fixed;
            bottom: 100px;
            right: 30px;
            padding: 15px 25px;
            background: #4caf50;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            z-index: 2000;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .toast.error {
            background: #f44336;
        }
        
        .toast.warning {
            background: #ff9800;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal h2 {
            margin-bottom: 20px;
        }
        
        .github-setup {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .github-setup input {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 1em;
        }
        
        .github-setup button {
            padding: 12px;
            background: #24292e;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
        }
        
        .github-setup button:hover {
            background: #1a1e22;
        }
        
        .setup-info {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .setup-info h4 {
            color: #2e7d32;
            margin-bottom: 10px;
        }
        
        .setup-info ol {
            margin-left: 20px;
        }
        
        .timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-weight: 600;
            z-index: 100;
        }
        
        .save-status {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-weight: 600;
            z-index: 100;
        }
        
        .save-status.saved {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .save-status.saving {
            background: #fff3e0;
            color: #f57c00;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 10px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 0 5px;
        }
        
        .info-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }
            
            .content {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .control-panel {
                bottom: 20px;
                right: 20px;
            }
        }
        
        .highlight {
            background: linear-gradient(to bottom, transparent 60%, #ffd93d 60%);
            padding: 2px 4px;
            font-weight: 600;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="timer" id="timer">⏱️ 00:00</div>
    <div class="save-status saved" id="saveStatus">✅ 자동 저장됨</div>
    
    <div class="container">
        <header>
            <h1>📚 요약하기: 인간과 AI의 협업</h1>
            <p class="subtitle">기술의 중심에 인간이 있다</p>
            <div class="student-info">
                <input type="text" id="studentId" placeholder="학번" />
                <input type="text" id="studentName" placeholder="이름" />
            </div>
        </header>
        
        <div class="content">
            <div class="progress-bar">
                <div class="progress-container">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
                <div class="progress-text" id="progressText">진행률: 0%</div>
            </div>
            
            <!-- 섹션 1: 도입 자료 -->
            <div class="section" data-section="1">
                <span class="section-status status-incomplete">미완료</span>
                <h2>🚀 1단계: AI vs 인간 요약 비교</h2>
                
                <div class="text-box">
                    <h3>📰 원문: 인공지능 시대의 일자리 변화</h3>
                    <p>
                        인공지능(AI) 기술의 급속한 발전으로 노동시장이 근본적인 변화를 맞이하고 있다. 맥킨지 글로벌 연구소의 2024년 보고서에 따르면, 향후 10년 내 전 세계 일자리의 약 30%가 자동화될 가능성이 있다. 특히 단순 반복 업무와 데이터 처리 업무가 AI로 대체될 위험이 높다. 
                    </p>
                    <p>
                        그러나 동시에 AI 전문가, 데이터 과학자, AI 윤리 전문가 등 새로운 직업군이 등장하고 있다. 세계경제포럼은 AI로 인해 사라지는 일자리보다 새로 창출되는 일자리가 더 많을 것으로 전망했다. 2025년까지 약 9,700만 개의 새로운 일자리가 생겨날 것으로 예측된다.
                    </p>
                    <p>
                        전문가들은 인간 고유의 창의성, 감성 지능, 복잡한 문제 해결 능력이 더욱 중요해질 것이라고 강조한다. 김영진 서울대 교수는 "AI는 인간을 대체하는 것이 아니라 인간의 능력을 증강시키는 도구"라며 "인간-AI 협업 능력이 미래 핵심 역량"이라고 말했다.
                    </p>
                </div>
                
                <div class="comparison-grid">
                    <div class="ai-box">
                        <h4>🤖 AI의 요약</h4>
                        <p>
                            맥킨지 보고서에 따르면 10년 내 전 세계 일자리 30%가 자동화될 예정이다. 단순 반복 업무와 데이터 처리 업무의 대체 위험이 높다. 반면 AI 전문가, 데이터 과학자 등 새로운 직업군이 등장하며, 세계경제포럼은 2025년까지 9,700만 개 신규 일자리 창출을 전망한다. 전문가들은 인간-AI 협업이 핵심이라고 강조한다.
                        </p>
                    </div>
                    
                    <div class="human-box">
                        <h4>👤 나의 요약</h4>
                        <textarea class="auto-save" data-field="section1_human_summary" 
                            placeholder="원문을 읽고 나만의 방식으로 요약해보세요..."></textarea>
                        <div class="char-count">0 / 500자</div>
                    </div>
                </div>
                
                <div class="activity">
                    <p class="activity-title">💭 활동 1: 차이점 분석하기</p>
                    <p>AI 요약과 인간 요약의 차이점을 3가지 이상 찾아보세요.</p>
                    <textarea class="auto-save" data-field="section1_activity1" 
                        placeholder="예시: 
1. AI는 숫자와 통계를 정확히 포함했지만, 나는 느낌과 해석을 더했다.
2. 
3. "></textarea>
                    <div class="char-count">0 / 500자</div>
                </div>
            </div>
            
            <!-- 섹션 2: 기계적 요약 규칙 -->
            <div class="section" data-section="2">
                <span class="section-status status-incomplete">미완료</span>
                <h2>🔧 2단계: 요약의 기계적 규칙</h2>
                
                <div class="info-box">
                    <h3>📋 기본 요약 규칙</h3>
                    <ol>
                        <li><strong>삭제 규칙</strong>: 중복되거나 부수적인 정보 제거</li>
                        <li><strong>선택 규칙</strong>: 핵심 정보와 중심 문장 선택</li>
                        <li><strong>일반화 규칙</strong>: 구체적 사례를 상위 개념으로 통합</li>
                        <li><strong>재구성 규칙</strong>: 선택된 정보를 논리적으로 재배열</li>
                    </ol>
                </div>
                
                <div class="activity">
                    <p class="activity-title">✏️ 활동 2: 기계적 규칙 적용하기</p>
                    <textarea class="auto-save" data-field="section2_activity1" 
                        placeholder="플라스틱 오염 텍스트를 4가지 규칙을 적용하여 요약하세요..."></textarea>
                    <div class="char-count">0 / 300자</div>
                </div>
            </div>
            
            <!-- 섹션 3: 다층적 요약 실습 -->
            <div class="section" data-section="3">
                <span class="section-status status-incomplete">미완료</span>
                <h2>🎨 3단계: 목적별 다층적 요약</h2>
                
                <div class="text-box">
                    <h3>📖 원문: 『사피엔스』 中 농업혁명</h3>
                    <p>
                        약 1만 년 전, 인류는 수렵채집 생활을 버리고 농업을 시작했다. 이 변화는 인류 역사상 가장 중요한 전환점이었다. 
                        농업혁명으로 인류는 한 곳에 정착하게 되었고, 인구가 폭발적으로 증가했다. 하지만 유발 하라리는 이를 "역사상 최대의 사기"라고 부른다. 
                        농업은 개인의 삶의 질을 떨어뜨렸다. 수렵채집인은 다양한 음식을 먹었지만, 농부는 단조로운 곡물에 의존했다. 
                        노동 시간은 늘어났고, 질병은 증가했다. 그렇다면 왜 농업을 선택했을까? 
                        농업은 더 많은 칼로리를 생산했고, 이는 더 많은 인구를 부양할 수 있었다. 
                        결국 농업혁명은 개인의 행복이 아닌 종의 생존과 번식에 유리했던 것이다.
                    </p>
                </div>
                
                <div class="activity">
                    <p class="activity-title">🎯 활동 3: 4가지 버전으로 요약하기</p>
                    
                    <div style="margin: 20px 0;">
                        <h4>1️⃣ AI처럼 (객관적 정보 중심)</h4>
                        <textarea class="auto-save" data-field="section3_ai_style" 
                            placeholder="통계, 사실, 연도 중심으로..."></textarea>
                        <div class="char-count">0 / 200자</div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <h4>2️⃣ SNS 한 줄 요약 (관심 유도)</h4>
                        <textarea class="auto-save" data-field="section3_sns" style="min-height: 60px;"
                            placeholder="임팩트 있게 한 문장으로..."></textarea>
                        <div class="char-count">0 / 100자</div>
                    </div>
                </div>
            </div>
            
            <!-- 최종 성찰 -->
            <div class="section" data-section="4" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
                <span class="section-status status-incomplete">미완료</span>
                <h2>💭 최종 성찰: AI 시대의 요약 능력</h2>
                
                <div class="activity">
                    <p class="activity-title">🌟 나의 생각 정리하기</p>
                    
                    <div style="margin: 20px 0;">
                        <p><strong>Q1. AI가 놓치는 것, 인간만이 포착할 수 있는 것은 무엇인가?</strong></p>
                        <textarea class="auto-save" data-field="reflection1" 
                            placeholder="예: 글쓴이의 숨은 의도, 문화적 맥락, 감정의 뉘앙스..."></textarea>
                        <div class="char-count">0 / 300자</div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <p><strong>Q2. 요약은 단순한 '줄이기'인가, '재창조'인가?</strong></p>
                        <textarea class="auto-save" data-field="reflection2" 
                            placeholder="나의 관점을 써보세요..."></textarea>
                        <div class="char-count">0 / 300자</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 컨트롤 패널 -->
    <div class="control-panel">
        <button class="btn btn-save" onclick="saveToLocal()">
            💾 로컬 저장
        </button>
        <button class="btn btn-github" onclick="showGitHubModal()">
            <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
            </svg>
            GitHub 저장
        </button>
        <button class="btn btn-export" onclick="exportData()">
            📥 내보내기
        </button>
    </div>
    
    <!-- 토스트 메시지 -->
    <div class="toast" id="toast"></div>
    
    <!-- GitHub 설정 모달 -->
    <div class="modal" id="githubModal">
        <div class="modal-content">
            <h2>🔐 GitHub 저장 설정</h2>
            
            <div class="setup-info">
                <h4>📋 설정 방법</h4>
                <ol>
                    <li>GitHub 계정이 없으면 생성</li>
                    <li>GitHub Personal Access Token 발급
                        <br><small>(Settings → Developer settings → Personal access tokens)</small>
                    </li>
                    <li>Repository 이름 입력 (없으면 자동 생성)</li>
                    <li>저장 클릭</li>
                </ol>
            </div>
            
            <div class="github-setup">
                <input type="text" id="githubToken" placeholder="GitHub Personal Access Token" />
                <input type="text" id="githubUsername" placeholder="GitHub 사용자명" />
                <input type="text" id="githubRepo" placeholder="Repository 이름 (예: korean-workbook)" value="korean-workbook" />
                <button onclick="saveToGitHub()">GitHub에 저장하기</button>
                <button onclick="closeModal()" style="background: #6c757d;">취소</button>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #fff3e0; border-radius: 8px;">
                <p style="font-size: 0.9em; color: #f57c00;">
                    <strong>💡 Tip:</strong> Token은 브라우저에만 저장되며, 'repo' 권한이 필요합니다.
                </p>
            </div>
        </div>
    </div>
    
    <script>
        // 전역 변수
        const STORAGE_KEY = 'summarization_workbook';
        const GITHUB_CONFIG_KEY = 'github_config';
        const START_TIME_KEY = 'workbook_start_time';
        
        let startTime = localStorage.getItem(START_TIME_KEY) || Date.now();
        if (!localStorage.getItem(START_TIME_KEY)) {
            localStorage.setItem(START_TIME_KEY, startTime);
        }
        
        // 페이지 로드 시 초기화
        window.addEventListener('DOMContentLoaded', () => {
            loadSavedData();
            updateProgress();
            setupAutoSave();
            setupCharacterCount();
            loadGitHubConfig();
        });
        
        // 타이머 업데이트
        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timer').textContent = 
                `⏱️ ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        setInterval(updateTimer, 1000);
        
        // 자동 저장 설정
        function setupAutoSave() {
            document.querySelectorAll('.auto-save').forEach(element => {
                element.addEventListener('input', () => {
                    autoSave();
                    updateProgress();
                });
            });
            
            document.querySelectorAll('#studentId, #studentName').forEach(element => {
                element.addEventListener('input', autoSave);
            });
        }
        
        // 글자 수 카운터
        function setupCharacterCount() {
            document.querySelectorAll('textarea').forEach(textarea => {
                const counter = textarea.nextElementSibling;
                if (counter && counter.classList.contains('char-count')) {
                    const maxLength = getMaxLength(textarea);
                    
                    // 초기 값 설정
                    counter.textContent = `${textarea.value.length} / ${maxLength}자`;
                    
                    textarea.addEventListener('input', () => {
                        const length = textarea.value.length;
                        counter.textContent = `${length} / ${maxLength}자`;
                        
                        if (length > maxLength) {
                            textarea.value = textarea.value.substring(0, maxLength);
                            counter.style.color = '#dc3545';
                        } else if (length > maxLength * 0.8) {
                            counter.style.color = '#ff9800';
                        } else {
                            counter.style.color = '#6c757d';
                        }
                    });
                }
            });
        }
        
        function getMaxLength(textarea) {
            const field = textarea.dataset.field;
            const limits = {
                'section1_human_summary': 500,
                'section1_activity1': 500,
                'section2_activity1': 300,
                'section3_ai_style': 200,
                'section3_sns': 100,
                'reflection1': 300,
                'reflection2': 300
            };
            return limits[field] || 500;
        }
        
        // 자동 저장
        function autoSave() {
            const data = collectData();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            updateSaveStatus('saved');
        }
        
        // 저장 상태 업데이트
        function updateSaveStatus(status) {
            const statusElement = document.getElementById('saveStatus');
            if (status === 'saved') {
                statusElement.className = 'save-status saved';
                statusElement.textContent = '✅ 자동 저장됨';
            } else if (status === 'saving') {
                statusElement.className = 'save-status saving';
                statusElement.textContent = '💾 저장 중...';
            }
        }
        
        // 데이터 수집
        function collectData() {
            const data = {
                studentId: document.getElementById('studentId').value,
                studentName: document.getElementById('studentName').value,
                timestamp: new Date().toISOString(),
                elapsedMinutes: Math.floor((Date.now() - startTime) / 1000 / 60),
                sections: {}
            };
            
            document.querySelectorAll('.auto-save').forEach(element => {
                const field = element.dataset.field;
                data.sections[field] = element.value;
            });
            
            return data;
        }
        
        // 저장된 데이터 불러오기
        function loadSavedData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const data = JSON.parse(saved);
                
                document.getElementById('studentId').value = data.studentId || '';
                document.getElementById('studentName').value = data.studentName || '';
                
                Object.keys(data.sections).forEach(field => {
                    const element = document.querySelector(`[data-field="${field}"]`);
                    if (element) {
                        element.value = data.sections[field];
                        
                        // 글자 수 업데이트
                        const counter = element.nextElementSibling;
                        if (counter && counter.classList.contains('char-count')) {
                            const maxLength = getMaxLength(element);
                            counter.textContent = `${element.value.length} / ${maxLength}자`;
                        }
                    }
                });
                
                showToast('이전 작업을 불러왔습니다', 2000);
            }
        }
        
        // 진행률 업데이트
        function updateProgress() {
            const totalFields = document.querySelectorAll('.auto-save').length;
            let completedFields = 0;
            
            document.querySelectorAll('.auto-save').forEach(element => {
                if (element.value && element.value.trim().length > 10) {
                    completedFields++;
                }
            });
            
            const progress = Math.round((completedFields / totalFields) * 100);
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `진행률: ${progress}%`;
            
            updateSectionStatus();
        }
        
        // 섹션 상태 업데이트
        function updateSectionStatus() {
            document.querySelectorAll('.section').forEach(section => {
                const fields = section.querySelectorAll('.auto-save');
                let completed = true;
                
                fields.forEach(field => {
                    if (!field.value || field.value.trim().length < 10) {
                        completed = false;
                    }
                });
                
                const statusElement = section.querySelector('.section-status');
                if (statusElement) {
                    if (completed && fields.length > 0) {
                        statusElement.className = 'section-status status-complete';
                        statusElement.textContent = '완료';
                    } else {
                        statusElement.className = 'section-status status-incomplete';
                        statusElement.textContent = '미완료';
                    }
                }
            });
        }
        
        // 로컬 저장
        function saveToLocal() {
            const data = collectData();
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            showToast('✅ 로컬에 저장되었습니다!', 2000);
        }
        
        // GitHub 설정 모달 표시
        function showGitHubModal() {
            document.getElementById('githubModal').style.display = 'flex';
            
            // 저장된 설정 불러오기
            const config = JSON.parse(localStorage.getItem(GITHUB_CONFIG_KEY) || '{}');
            if (config.username) {
                document.getElementById('githubUsername').value = config.username;
            }
            if (config.repo) {
                document.getElementById('githubRepo').value = config.repo;
            }
            // 토큰은 보안상 표시하지 않음
        }
        
        // 모달 닫기
        function closeModal() {
            document.getElementById('githubModal').style.display = 'none';
        }
        
        // GitHub 설정 불러오기
        function loadGitHubConfig() {
            const config = JSON.parse(localStorage.getItem(GITHUB_CONFIG_KEY) || '{}');
            if (config.token) {
                // 토큰이 있으면 GitHub 버튼 활성화 표시
                const githubBtn = document.querySelector('.btn-github');
                if (githubBtn) {
                    githubBtn.textContent = '✅ GitHub 저장';
                }
            }
        }
        
        // GitHub에 저장
        async function saveToGitHub() {
            const token = document.getElementById('githubToken').value;
            const username = document.getElementById('githubUsername').value;
            const repo = document.getElementById('githubRepo').value;
            
            if (!token || !username || !repo) {
                showToast('모든 필드를 입력해주세요', 2000, 'error');
                return;
            }
            
            // 설정 저장
            const config = { username, repo, token };
            localStorage.setItem(GITHUB_CONFIG_KEY, JSON.stringify(config));
            
            try {
                // 워크북 데이터 수집
                const data = collectData();
                const studentId = data.studentId || 'unknown';
                const studentName = data.studentName || 'unknown';
                const date = new Date().toISOString().split('T')[0];
                const fileName = `submissions/${date}_${studentId}_${studentName}.json`;
                
                // Repository 확인 또는 생성
                const repoResponse = await fetch(`https://api.github.com/repos/${username}/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (repoResponse.status === 404) {
                    // Repository 생성
                    await fetch('https://api.github.com/user/repos', {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            name: repo,
                            description: '국어 요약하기 워크북 제출물',
                            private: false,
                            auto_init: true
                        })
                    });
                    
                    // 잠시 대기
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
                
                // 파일 존재 확인
                let sha = null;
                const fileResponse = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${fileName}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (fileResponse.ok) {
                    const fileData = await fileResponse.json();
                    sha = fileData.sha;
                }
                
                // 파일 저장 또는 업데이트
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
                
                const saveResponse = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${fileName}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `워크북 제출: ${studentName} (${studentId})`,
                        content: content,
                        sha: sha
                    })
                });
                
                if (saveResponse.ok) {
                    closeModal();
                    showToast('✅ GitHub에 저장되었습니다!', 3000);
                    
                    // 저장 URL 생성
                    const savedUrl = `https://github.com/${username}/${repo}/blob/main/${fileName}`;
                    console.log('저장된 파일:', savedUrl);
                    
                    // README 업데이트
                    await updateReadme(username, repo, token, data);
                } else {
                    const error = await saveResponse.json();
                    showToast(`저장 실패: ${error.message}`, 3000, 'error');
                }
                
            } catch (error) {
                console.error('GitHub 저장 오류:', error);
                showToast('저장 중 오류가 발생했습니다', 3000, 'error');
            }
        }
        
        // README 파일 업데이트
        async function updateReadme(username, repo, token, data) {
            try {
                const date = new Date().toLocaleString('ko-KR');
                const studentInfo = `${data.studentName} (${data.studentId})`;
                
                // README 가져오기
                let readmeContent = `# 📚 국어 요약하기 워크북 제출 현황\n\n`;
                readmeContent += `## 최근 제출\n\n`;
                readmeContent += `| 날짜 | 학생 | 진행률 | 작업시간 |\n`;
                readmeContent += `|------|------|--------|----------|\n`;
                readmeContent += `| ${date} | ${studentInfo} | ${document.getElementById('progressText').textContent} | ${data.elapsedMinutes}분 |\n`;
                
                const readmeResponse = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/README.md`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `README 업데이트: ${studentInfo} 제출`,
                        content: btoa(unescape(encodeURIComponent(readmeContent)))
                    })
                });
                
            } catch (error) {
                console.log('README 업데이트 스킵:', error);
            }
        }
        
        // 데이터 내보내기
        function exportData() {
            const data = collectData();
            const studentName = data.studentName || '학생';
            const date = new Date().toISOString().split('T')[0];
            
            // JSON 파일로 다운로드
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `요약워크북_${studentName}_${date}.json`;
            a.click();
            
            showToast('📥 파일이 다운로드되었습니다', 2000);
        }
        
        // 토스트 메시지
        function showToast(message, duration = 2000, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        
        // 5분마다 자동 저장
        setInterval(() => {
            autoSave();
            showToast('자동 저장되었습니다', 1000);
        }, 300000);
        
        // 페이지 떠나기 전 경고
        window.addEventListener('beforeunload', (e) => {
            const data = collectData();
            if (Object.keys(data.sections).some(key => data.sections[key])) {
                e.preventDefault();
                e.returnValue = '작성 중인 내용이 있습니다. 페이지를 떠나시겠습니까?';
            }
        });
        
        // 단축키
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveToLocal();
            }
        });
    </script>
</body>
</html>
